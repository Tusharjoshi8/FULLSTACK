<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Crypto Live Tracker</title>

<style>
  body {
    font-family: Arial;
    background: #f5f5f5;
    padding: 20px;
    display: flex;
    justify-content: center;
  }
  .card {
    background: #fff;
    padding: 20px;
    width: 380px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  h2 { margin: 0 0 15px; text-align: center; }
  .price-box {
    font-size: 28px;
    text-align: center;
    margin-bottom: 10px;
  }
  .green { color: #16a34a; }
  .red { color: #dc2626; }
  .time {
    font-size: 14px;
    text-align: center;
    color: #555;
    margin-bottom: 10px;
  }
  canvas {
    background: #fff;
    border-radius: 6px;
  }
</style>
</head>
<body>

<div class="card">
  <h2>Bitcoin Live Price</h2>

  <div id="price" class="price-box">Loading...</div>
  <div id="updated" class="time"></div>

  <canvas id="chart" height="250"></canvas>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const API = "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd";
let history = [];      // store price history
let lastPrice = null;  // compare for green/red

const priceEl = document.getElementById("price");
const updatedEl = document.getElementById("updated");
const ctx = document.getElementById("chart");

let chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "BTC Price (USD)",
      data: [],
      borderWidth: 2,
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    scales: { y: { beginAtZero: false } }
  }
});

/* Fetch Live Price */
async function fetchPrice() {
  try {
    const res = await fetch(API);
    const data = await res.json();

    const price = data.bitcoin.usd;
    const time = new Date().toLocaleTimeString();

    // Add to chart history
    history.push(price);
    if (history.length > 20) history.shift(); // limit data points

    // Update UI
    updatePriceUI(price);
    updateChart(time, price);
  } catch (error) {
    priceEl.textContent = "Error!";
    priceEl.className = "red";
  }
}

/* Update Price Display */
function updatePriceUI(price) {
  if (lastPrice === null) {
    priceEl.textContent = `$${price}`;
    lastPrice = price;
    return;
  }

  if (price > lastPrice) {
    priceEl.className = "green";
    priceEl.textContent = `$${price} ↑`;
  } else if (price < lastPrice) {
    priceEl.className = "red";
    priceEl.textContent = `$${price} ↓`;
  } else {
    priceEl.className = "";
    priceEl.textContent = `$${price}`;
  }

  updatedEl.textContent = "Updated: " + new Date().toLocaleTimeString();
  lastPrice = price;
}

/* Update Chart */
function updateChart(time, price) {
  chart.data.labels.push(time);
  chart.data.datasets[0].data.push(price);

  if (chart.data.labels.length > 20) {
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
  }

  chart.update();
}

/* Auto-refresh every 5 seconds */
fetchPrice();
setInterval(fetchPrice, 5000);
</script>
</body>
</html>
